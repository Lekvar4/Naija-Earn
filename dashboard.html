<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Dashboard — Naija Earn</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header class="navbar">
    <a class="brand" href="dashboard.html">
      <svg viewBox="0 0 60 40" xmlns="http://www.w3.org/2000/svg"><rect width="60" height="40" fill="#fff"/><rect width="18" height="40" fill="#007A3D"/><rect x="42" width="18" height="40" fill="#007A3D"/></svg>
      <div>
        <div style="font-weight:800">Naija Earn</div>
        <div style="font-size:12px; opacity:0.9">Your dashboard</div>
      </div>
    </a>

    <div>
      <a class="sm" href="index.html">Home</a>
      <a class="sm" href="withdrawal.html">Withdraw</a>
      <a class="sm" href="admin.html">Admin</a>
    </div>
  </header>

  <main class="container">
    <div class="card row">
      <div class="col">
        <h2 id="welcome">Hello, User</h2>
        <p class="small" id="userFull"></p>

        <p style="margin-top:10px">Balance: <span class="balance" id="balance">₦0</span></p>

        <div style="margin-top:14px">
          <button class="btn" id="mineBtn">Mine (Earn ₦200)</button>
          <button class="btn secondary" id="autoMineBtn" style="margin-left:8px">Start Auto Mine</button>
        </div>

        <p class="small" style="margin-top:12px">Auto mine will add ₦100 every 6 seconds. Click again to stop.</p>
      </div>

      <div class="col">
        <h3>Quick Actions</h3>

        <div class="card" style="background:#f7fff8;">
          <h4 style="margin-bottom:8px">Withdraw</h4>
          <p class="small">Minimum withdraw: ₦5,000. First withdrawal fee: ₦1,000.</p>

          <form id="withdrawForm">
            <label>Choose Bank</label>
            <select id="bank" required>
              <option value="">Select bank</option>
              <option>Zenith Bank</option>
              <option>GTBank</option>
              <option>Access Bank</option>
              <option>UBA</option>
              <option>First Bank</option>
              <option>Guarantee Trust Bank</option>
              <option>Opay(paycom)</option>
              <option>Palmpay</option>
            </select>

            <label>Account Number</label>
            <input id="acct" type="text" placeholder="0123456789" required>

      <label>Amount (₦)</label>
      <input type="number" id="withdrawAmount" min="5000" required>
                <label>Upload Screenshot Proof</label>
      <input type="file" id="proofFile" accept="image/*" required>

      <button type="submit" class="success">Request Withdrawal</button>
    </form>

    <p id="withdrawMessage" style="margin-top:15px; font-weight:600;"></p>
  </div>

  <div id="liveAlert"></div>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-storage.js"></script>

  <script>
    // Firebase Config
    const firebaseConfig = {
      apiKey: "AIzaSyBvWBJ45YSWoJwhRdxKSenrJ1pwcERLV4s",
      authDomain: "naijaearn-6d914.firebaseapp.com",
      projectId: "naijaearn-6d914",
      storageBucket: "naijaearn-6d914.appspot.com",
      messagingSenderId: "187057450801",
      appId: "1:187057450801:web:e02de3eaacbd0673574a10",
      measurementId: "G-Z0NDLB643E"
    };
    const app = firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();
    const storage = firebase.storage();

    // Handle withdrawal
    const withdrawForm = document.getElementById("withdrawForm");
    const withdrawMessage = document.getElementById("withdrawMessage");

    withdrawForm.addEventListener("submit", async (e) => {
      e.preventDefault();

      const user = auth.currentUser;
      if (!user) {
        withdrawMessage.textContent = "⚠️ Please login first.";
        withdrawMessage.style.color = "red";
        return;
      }

      const bank = document.getElementById("bankName").value;
      const acc = document.getElementById("accountNumber").value;
      const amt = document.getElementById("withdrawAmount").value;
      const file = document.getElementById("proofFile").files[0];

      if (!file) {
        withdrawMessage.textContent = "⚠️ Please upload screenshot proof.";
        withdrawMessage.style.color = "red";
        return;
      }

      withdrawMessage.textContent = "⏳ Uploading screenshot...";
      withdrawMessage.style.color = "orange";

      try {
        // Upload proof to Firebase Storage
        const proofRef = storage.ref().child(`proofs/${user.uid}_${Date.now()}.jpg`);
        await proofRef.put(file);
        const proofURL = await proofRef.getDownloadURL();

        // Save withdrawal request in Firestore
        await db.collection("withdrawals").add({
          uid: user.uid,
          bank: bank,
          account: acc,
          amount: amt,
          proof: proofURL,
          status: "pending",
          createdAt: firebase.firestore.FieldValue.serverTimestamp()
        });

        withdrawMessage.textContent = `✅ Withdrawal request of ₦${amt} submitted. Pending admin approval.`;
        withdrawMessage.style.color = "green";
        withdrawForm.reset();
      } catch (err) {
        console.error(err);
        withdrawMessage.textContent = "❌ Error: " + err.message;
        withdrawMessage.style.color = "red";
      }
    });
  </script>

    <div class="card">
      <h3>My Activity</h3>
      <div id="activityList" class="small">
        <p>No activity yet.</p>
      </div>
    </div>

    <div class="card">
      <div class="row-between">
        <h3>Account</h3>
        <div>
          <button class="btn secondary" id="accountLogout">Logout</button>
        </div>
      </div>

      <table class="table">
        <thead><tr><th>Field</th><th>Value</th></tr></thead>
        <tbody>
          <tr><td>Username</td><td id="infoUsername"></td></tr>
          <tr><td>Full name</td><td id="infoFullname"></td></tr>
          <tr><td>First withdrawal paid</td><td id="infoFirstPaid"></td></tr>
        </tbody>
      </table>
    </div>
  </main>

  <div id="liveAlert"></div>
 <script type="module" src="script.js"></script>
</body>
</html>

